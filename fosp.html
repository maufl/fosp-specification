<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The Federated Object Sharing Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The Federated Object Sharing Protocol">
<meta name="keywords" content="FOSP">
<meta name="generator" content="xml2rfc v1.36 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">F. Maurer</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">March 2014</td></tr>
<tr><td class="header">Expires: September 2, 2014</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The Federated Object Sharing Protocol<br />fosp-00</h1>

<h3>Abstract</h3>

<p>This document describes the Federated Object Sharing Protocol (FOSP).
				FOSP is a protocol that allows sharing arbitrary data,
				setting access rights on the shared data and receiving notifications on changes.
				Furthermore, all features of FOSP can be used in a federated network,
				e.g. between multiple independed providers.
				It was designed to be the most simple solution that combines all these features.
</p>
<h3>Status of this Memo</h3>
<p>
This document is an Internet-Draft and is
NOT offered in accordance with Section&nbsp;10 of RFC&nbsp;2026,
and the author does not provide the IETF with any rights other
than to publish as an Internet-Draft.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on September 2, 2014.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#purpose">1.1.</a>&nbsp;
Purpose<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#overview">1.2.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#conventions">1.3.</a>&nbsp;
Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#requirements">1.4.</a>&nbsp;
Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#terminology">1.5.</a>&nbsp;
Terminology<br />
<a href="#nettop">2.</a>&nbsp;
Network Topology<br />
<a href="#messages">3.</a>&nbsp;
Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg-type">3.1.</a>&nbsp;
Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg-type-request">3.1.1.</a>&nbsp;
Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg-type-response">3.1.2.</a>&nbsp;
Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg-type-notification">3.1.3.</a>&nbsp;
Notification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg-format">3.2.</a>&nbsp;
Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg-serialization">3.3.</a>&nbsp;
Serialization<br />
<a href="#data-structure">4.</a>&nbsp;
Data structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#objects">4.1.</a>&nbsp;
Objects<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#obj-trees">4.2.</a>&nbsp;
Trees<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#attachments">4.3.</a>&nbsp;
Attachments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#fields">4.4.</a>&nbsp;
Standart Fields<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#std-objs">4.5.</a>&nbsp;
Standart Objects<br />
<a href="#policies">5.</a>&nbsp;
Policies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#access-control">5.1.</a>&nbsp;
Access control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#subscriptions">5.2.</a>&nbsp;
Subscriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pol-attachments">5.3.</a>&nbsp;
Attachments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pol-auth-reg">5.4.</a>&nbsp;
Authentication and Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pol-msg-forw">5.5.</a>&nbsp;
Message forwarding<br />
<a href="#con-init">6.</a>&nbsp;
Connection Initiation<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="purpose"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Purpose</h3>

<p>TODO
</p>
<p>The federated object storage protocol tries to solve three problems:
		</p>
<ol class="text">
<li>How to store data in a network and support standart operations on it.
</li>
<li>How to enforce access control on the data, for useres from different hosts, without central authentication.
</li>
<li>How to notify users when data is added, removed or has changed.
</li>
</ol><p>
	
</p>
<p>Additionally we want to keep following constraints:
		</p>
<ol class="text">
<li>The protocol needs tp be data agnostic and should support structured, unstructured and metadata.
</li>
<li>The protocol must be as simple as possible, it must be easy to implement and programms that use it should be easy to deploy.
</li>
</ol><p>
	
</p>
<a name="overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Overview</h3>

<p>The FOSP protocol is mostly a request/response protocol. 
		A user connects to the server of his or her provider, using a client and then both can exchange messages. 
		Request messages are sent from the client to the server to manipulate or retrieve data. 
		Servers respond by sending a response message.
	
</p>
<p>The information units stored on the server have a well defined structure and we call them objects. 
		They are furthermore organized into trees. 
		Each user is identified uniquely by a name and the domain name of his or her provider, similar to an Email address. 
		For each user there exists a tree of objects, stored on the server(s) of his or her provider.
	
</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Conventions</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
		"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
		document are to be interpreted as described in <a class='info' href='#refs.rfc2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [refs.rfc2119].
	
</p>
<a name="requirements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Requirements</h3>

<p>FOSP builds on existing protocols and data formats. 
		The transport protocol for FOSP messages currently is the WebSocket protocol, tough other options may be added in the future. 
		Objects are serialized into the JSON notations. 
		Besides these technical dependencies, FOSP is inspired by WebDAV and XMPP and has similarities to LDAP.
	
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Terminology</h3>

<p>This document uses a number of terminologies to refer to concepts found in FOSP.
		</p>
<blockquote class="text"><dl>
<dt>provider</dt>
<dd>An entity that provides storage space on the Internet for the data of users. 
				It is identified by a DNS domain name.
			
</dd>
<dt>server</dt>
<dd>A FOSP server stores the data of users of a certain provider. 
				Multiple servers can be deployed to deliver the data of a provider to implement fault tolerance and load balancing.
			
</dd>
<dt>client</dt>
<dd>A FOSP client is a program a user uses to communicate with a FOSP server. 
				It facilitates accessing the data of the user that is stored on the server.
			
</dd>
<dt>message</dt>
<dd>A message is the basic unit of communication in FOSP. 
				Messages come in three different flavours.
			
</dd>
<dt>request</dt>
<dd>A request is a message sent from a client to a server. 
				It is used to retrieve or alter data.
			
</dd>
<dt>response</dt>
<dd>A response is a message sent from a server to a client. 
				It is always sent as an answer to a request and contains the status of the request and possibly data.
			
</dd>
<dt>notification</dt>
<dd>A notification is a message that is sent by servers when changes happen to an object.
			
</dd>
</dl></blockquote><p>
	
</p>
<a name="nettop"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Network Topology</h3>

<p>In the FOSP network, agents are either clients or servers. Each server belongs to
	one provider that is identified by a domain name. For load balancing purposes,
	more than one server per domain might be used. To keep the examples simple,
	we nevertheless assume that there is one server per provider and use the term
	provider and server interchangeable. A user connects, using a client, to the server
	of their provider. We refer to this server as the home server
	of the user.

</p>
<p>To manipulate or access data, the user sends requests. A request can
	act upon a resource. If the resource is not managed by the server the user is con-
	nected to, the server will relay the request to the responsible server. Hence, FOSP
	servers may open connections to other FOSP servers.

</p>
<a name="messages"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Messages</h3>

<p>Messages are the basic unit of communication in the FOSP network.
	There are three different types of messages which serve different purposes.
	After being serialized, each message is transported over a WebSocket connection inside of one WebSocket text message or binary message.

</p>
<a name="msg-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Types</h3>

<p>Each message has a specific type, which determines the kind of purpose this mes-
		sage serves. The type is implicitly given in the way that the content of the message
		determines it’s type. For now there are only three types of messages needed to sup-
		port all functionality. The types are requests, responses and notifications. Should
		there be the need for additional types of messages, a new one can be added in
		later versions of the protocol. All messages can have headers and a body, similar
		to HTTP messages and are distinguished by their main attributes.
	
</p>
<a name="msg-type-request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Request</h3>

<p>Requests are sent from clients to servers to authenticate or manipulate objects.
			A request consists of ...
			</p>
<blockquote class="text">
<p>a request type
</p>
<p>optionally an identifier of a resource that it manipulates
</p>
<p>a sequence number
</p>
</blockquote><p>
			The request type is one of the following ...
			</p>
<blockquote class="text"><dl>
<dt>CONNECT</dt>
<dd>used to initiate a connection
</dd>
<dt>REGISTER</dt>
<dd>used to create a new FOSP user
</dd>
<dt>AUTHENTICATE</dt>
<dd>used to authenticate
</dd>
<dt>SELECT</dt>
<dd>retrieves an object
</dd>
<dt>CREATE</dt>
<dd>adds a new object
</dd>
<dt>UPDATE</dt>
<dd>changes an existing object
</dd>
<dt>DELETE</dt>
<dd>removes an object and all its children
</dd>
<dt>LIST</dt>
<dd>returns a list of children of an object
</dd>
<dt>READ</dt>
<dd>download the attached file of an object
</dd>
<dt>WRITE</dt>
<dd>upload a file as an attachment to an object
</dd>
</dl></blockquote><p>
			The content of the body depends on the type of request. For example, the body
			of a SELECT or DELETE request is empty and the body of a CREATE request
			contains the new object. In general the body is a JSON object or array, except for
			the WRITE request that has the byte representation of the file as the body.
		
</p>
<a name="msg-type-response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Response</h3>

<p>Responses are sent from servers to clients when a request has been processed.
			A response has ...
			</p>
<blockquote class="text">
<p>a type, either “SUCCEEDED” or “FAILED”.
</p>
<p>a status code, an integer greater zero.
</p>
<p>a sequence number which must match the sequence number of the request
					it responds to.
				
</p>
</blockquote><p>
			The body of a response depends on the request that is answered. For a CREATE or
			DELETE request it would be empty, for a SELECT request it would be the object
			that was requested. In case of a READ request it would contain the file.
		
</p>
<a name="msg-type-notification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.3"></a><h3>3.1.3.&nbsp;
Notification</h3>

<p>Notifications are sent from servers to clients when objects change and the client
			has subscribed to those changes. A notification consists of ...
			</p>
<blockquote class="text">
<p>an event which is one of “CREATED”, “UPDATED” or “DELETED”.
</p>
<p>a resource identifier.
</p>
</blockquote><p>
			The notifications are sent when a request triggers an event, for example CRE-
			ATE triggers a CREATED event. If the event equals DELETED then the body
			of the notification must be empty. Otherwise it should contain the new version
			of the object.
		
</p>
<a name="msg-format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Format</h3>

<p>**WARNING: To simplify the definition for the moment, only ASCII characters are used.
		This WILL change as the protocol itself mandates the use of Unicode and the UTF-8 encoding and international user and resource names MUST be supported**
	
</p>
<p>Also the header definition will be subject to change after determining acceptable characters.
		For the resource identifier, we will probably refer to the IRI definition in the future.
	
</p><br /><hr class="insert" />
<a name="fosp-abnf"></a>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
<dfn>message</dfn>       = <cite class='id'>request</cite> / <cite class='id'>response</cite> / <cite class='id'>notification</cite>

<dfn>request</dfn>       = <cite class='id'>request-type</cite> <cite class='key'>SP</cite> ( <cite class='id'>resource-id</cite> / "<span class='str'>*</span>" )
                <cite class='key'>SP</cite> <cite class='id'>sequence-number</cite> <cite class='key'>CRLF</cite> <cite class='id'>headers</cite> [ <cite class='key'>CRLF</cite> <cite class='id'>body</cite> ]

<dfn>request-type</dfn>  = "<span class='str'>CONNECT</span>" / "<span class='str'>AUTHENTICATE</span>" / "<span class='str'>REGISTER</span>" / "<span class='str'>CREATE</span>"
                / "<span class='str'>SELECT</span>" / "<span class='str'>UPDATE</span>" / "<span class='str'>DELETE</span>" / "<span class='str'>READ</span>" / "<span class='str'>WRITE</span>"

<dfn>response</dfn>      = <cite class='id'>response-type</cite> <cite class='key'>SP</cite> <cite class='id'>response-status</cite>
                <cite class='key'>SP</cite> <cite class='id'>sequence-number</cite> <cite class='key'>CRLF</cite> <cite class='id'>headers</cite> [ <cite class='key'>CRLF</cite> <cite class='id'>body</cite> ]

<dfn>response-type</dfn> = "<span class='str'>SUCCEDED</span>" / "<span class='str'>FAILED</span>"

<dfn>notification</dfn>  = <cite class='id'>event-type</cite> <cite class='key'>SP</cite> <cite class='id'>resource-id</cite> <cite class='key'>CRLF</cite> <cite class='id'>headers</cite> [ <cite class='key'>CRLF</cite> <cite class='id'>body</cite> ]

<dfn>event-type</dfn>    = "<span class='str'>CREATED</span>" / "<span class='str'>UPDATED</span>" / "<span class='str'>DELETED</span>"

<dfn>headers</dfn>       = <span class='rep'>*</span>( <cite class='id'>header</cite> <cite class='key'>CRLF</cite> )

<dfn>header</dfn>        = <cite class='id'>header-key</cite> "<span class='str'>:</span>" <cite class='key'>SP</cite> <cite class='id'>header-value</cite>

<dfn>header-key</dfn>    = <cite class='key'>ALPHA</cite> <span class='rep'>*</span>( <cite class='id'>ALPHANUM</cite> / "<span class='str'>-</span>" ) ( <cite class='id'>ALPHANUM</cite> )

<dfn>header-value</dfn>  = <span class='rep'>1*</span>( <cite class='id'>ALPHANUM</cite> / "<span class='str'>/</span>" / "<span class='str'>-</span>" / "<span class='str'>&lt;</span>" / "<span class='str'>&gt;</span>" / "<span class='str'>=</span>"
                / "<span class='str'>+</span>" / "<span class='str'>_</span>" / "<span class='str'>;</span>" / "<span class='str'>!</span>" / "<span class='str'>~</span>" / "<span class='str'>*</span>" / "<span class='str'>.</span>" )

<dfn>resource-id</dfn>   = <cite class='id'>user-name</cite> "<span class='str'>@</span>" <cite class='id'>domain</cite> [ <cite class='id'>path</cite> ]

<dfn>user-name</dfn>     = <cite class='key'>ALPHA</cite> <span class='rep'>*</span>( <cite class='id'>ALPHANUM</cite> / "<span class='str'>_</span>" / "<span class='str'>-</span>" / "<span class='str'>+</span>" / "<span class='str'>.</span>" )
                ( <cite class='id'>ALPHANUM</cite> )

<dfn>domain</dfn>        = <cite class='id'>domain-part</cite> <span class='rep'>*</span>( "<span class='str'>.</span>" <cite class='id'>domain-part</cite> ) [ "<span class='str'>.</span>" ]

<dfn>domain-part</dfn>   = <cite class='id'>ALPHANUM</cite> / ( <cite class='id'>ALPHANUM</cite> <span class='rep'>*</span>( <cite class='id'>ALPHANUM</cite> / "<span class='str'>-</span>" / "<span class='str'>_</span>" )
                  <cite class='id'>ALPHANUM</cite> )

<dfn>path</dfn>          = "<span class='str'>/</span>" / <span class='rep'>1*</span>( "<span class='str'>/</span>" <cite class='id'>path-part</cite> )

<dfn>path-part</dfn>     = <span class='rep'>1*</span>( <cite class='id'>ALPHANUM</cite> / "<span class='str'>\</span>" / "<span class='str'>.</span>" / "<span class='str'>+</span>" / "<span class='str'>*</span>" / "<span class='str'>-</span>" / "<span class='str'>_</span>"
                / "<span class='str'>;</span>" / "<span class='str'>:</span>" / "<span class='str'>!</span>" / "<span class='str'>~</span>" / "<span class='str'>=</span>" / "<span class='str'>&lt;</span>" / "<span class='str'>&gt;</span>" )

<dfn>ALPHANUM</dfn>      = <cite class='key'>ALPHA</cite> / <cite class='key'>DIGIT</cite>
</pre></div>
<p>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="msg-serialization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Serialization</h3>

<p>Messages are serialized into a blob of bytes. Most of the message is text in UTF-
		8 encoding, only the body is either a valid JSON object, UTF-8 encoded, or not
		interpreted at all. The second case occurs when an attached file is up- or down-
		loaded. The beginning and end, e.g. the length of a message must be determined
		from lenght of the WebSocket message.
	
</p>
<a name="data-structure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Data structure</h3>

<a name="objects"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Objects</h3>

<p>We refer to the basic unit of data, that can be manipulated in the FOSP network,
		as an object. An object consists of key-value pairs. The constraints for keys and
		values are the ones described by the JSON specification. Each object has
		by default specific key value pairs that have a special meaning, for example, the key
		“owner” contains the identifier of the user who created the object.
		When transfering objects in messages, the object is serialized according to the JSON specification.
	
</p>
<a name="obj-trees"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Trees</h3>

<p>In FOSP, all objects are part of a tree of objects. Therefore, all objects have a parent
		object, except for the root object of a tree. Consequently, all objects can have child
		objects. For each user there exists one tree of objects and the root node of this
		tree is named like the identifier of the user. The tree of the user is stored on
		the servers that are responsible for the domain where the user is registered.
	
</p>
<a name="attachments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Attachments</h3>

<p>As files, like pictures and documents, are also shared via social networks, FOSP
		supports saving binary files. For each object, one file can be saved as an attach-
		ment. This way, files can be addressed with the same schema and the objects they
		are attached to can provide the meta-data. If an object has a belonging file, it is
		extended by a new attributes named “attachment”. In this attribute, the size, file
		name, and mime-type of the file is saved. The attached file is read and written
		using special requests.
	
</p>
<a name="fields"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Standart Fields</h3>

<p>Most attributes of an object have a well defined meaning. The servers have to
		ensure that the content of these attributes adheres to the specification and that
		users do not make changes that are not allowed. Figure 4.5 shows an example of
		an objects with all the fields described here. Currently we define the following
		attributes and their values:
		</p>
<blockquote class="text">
<p>The “owner” field is set by the server on creation of the object and contains
				the identifier of the user who created the object as a string. It determines
				the ownership of this object and is used when enforcing access rights.
			
</p>
<p>The “btime” (birth time) field is set by the server to the date of creation
				of the object. It is saved as a string, formatted according to the ISO 8601
				standard and must always be in the UTC time zone. Users should not be
				able to change its content. It was added because it’s an information that is
				usually of interest to users.
			
</p>
<p>Similar the “mtime” (modify time) is set to the current date each time the
				object is altered and is not to be set by the users directly. It is saved just like
				“btime”. In the future it will be used to allow client side caching similar to
				ETags in HTTP.
			
</p>
<p>e recommend that users should not be allowed to add or alter arbitrary
				fields except for the “data” and “type” field. The “data” field is where the user
				should save the payload and may contain any valid value. The “type” field
				should contain a string that describes the content type of the “data” field,
				similar to MIME types.
			
</p>
</blockquote><p>
	
</p>
<p>Furthermore, there are the three fields “acl”, “subscriptions” and “attachment”
		that contain more complex objects.
	
</p>
<p>The “acl” field saves information about access rights. It is read by the server
		to enforce access control.
		</p>
<blockquote class="text">
<p>The acl object can have the following fields: “owner”, “users”, “groups”,
				“other”
			
</p>
<p>The value of the “owner” and “other” field is a set of rights
</p>
<p>A set of rights is an array of strings where each string identifies a cer-
				tain right. For example, the string ”read-acl” stands for the right to
				read the “acl” field.
			
</p>
<p>The value of the “users” and “groups” field is an object. In these objects,
				each key identifies a user or a group and the related value is a set of
				rights.
			
</p>
</blockquote><p>
	
</p>
<p>The “subscriptions” field saves information about subscriptions. It is read
		by the server to determine which users have to be notified on changes to an
		object.
		</p>
<blockquote class="text">
<p>It contains an object and each key is the identifier of a user.
</p>
<p>The value is an object with the fields: “events” and “depth”
</p>
<p>The value of “events” is an array of strings which identify an event, the
				value of “depth” is an integer between -1 and infinity
			
</p>
</blockquote><p>
	
</p>
<p>The “attachment” field is only present if this object has an attachment. It
		contains an object with three fields.
		</p>
<blockquote class="text">
<p>The “name” field contains a string with the file name.
</p>
<p>The “size” field contains the number of bytes of the attached file.
</p>
<p>The “mime-type” field contains a string with the mime-type of the at-
				tached file.
			
</p>
</blockquote><p>
	
</p><br /><hr class="insert" />
<a name="fosp-obj-example"></a>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

{
  btime: "2007-03-01T13:00:00Z",
  mtime: "2008-05-11T15:30:00Z",
  owner: "alice@wonderland.lit",
  acl: {
    owner: ["read-data", "write-data", "read-acl", "write-acl",
      "read-subscriptions", "write-subscriptions",
      "read-children", "write-children", "delete-children"],
    users: {
      alice@wonderland.lit: [
        "read-data",
        "not-write-data",
        "read-acl",
        "write-acl",
        "read-subscriptions",
        "not-write-subscriptions"
      ]
    }
  },
  subscriptions: {
    users: {
      alice@wonderland.lit: {
        events: [ "created", "updated" ],
        depth: 1
      }
    }
  },
  type: "text/plain",
  data: "Just plain text"
}

</pre></div>
<p>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="std-objs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Standart Objects</h3>

<p>Some objects in the tree of a user will be used by the server to obtain configurations.
		For example alice@wonderland.lit/config/groups will contain the mapping from users to groups.
	
</p>
<a name="policies"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Policies</h3>

<p>Besides implementing the technical specification of the protocol, the server has
	to enforce a set of policies. These policies describe how the server interprets the
	objects to enforces access control and send notifications for subscriptions. They
	also define constraints on certain attributes of objects and constraints on whether
	or not a message should be forwarded.

</p>
<a name="access-control"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Access control</h3>

<p>As stated in the previous section, each object can save access control information.
		A valid entry in the access control list consists of the identifier of a user or a group
		of users and a list of rights. Manipulation of different parts of the object can re-
		quire different rights, for example, altering access control information requires
		the “acl-write” right. Because the objects are part of a tree, we can use inheritance
		to set access rights for a whole subtree by setting the appropriate access control
		information on the root of the subtree. This way the rights on an object are the
		sum of the rights on this object and all it’s ancestors. To still be able to have less
		rights on a child object, rights can be prefix with “not-” to explicitly remove a
		right, for example “not-acl-write”. The server must enforce access control for an
		object in the following way.
		</p>
<ol class="text">
<li>Check if the right in question is set on the current object
</li>
<li>If it is set positive (e.g. not prefixed with “not-”) grant access
</li>
<li>If it is set negative (e.g. prefixed with “not-”) deny access
</li>
<li>If is is not set, go to the parent object and repeat from step 1.
</li>
<li>If the current object is already the root object, deny access
</li>
</ol><p>
	
</p>
<a name="subscriptions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Subscriptions</h3>

<p>Similar to the access control information, subscriptions can be set on objects so
		that a user will be notified when changes occur. A subscription consists of an
		identifier of a user, a list of events to subscribe to and a “depth”. The depth is used
		to subscribe to events from all child objects to a certain depth. When a change
		happens on an object, the server must use the following algorithm to determine
		which users must be notified.
		</p>
<ol class="text">
<li>Read the “subscriptions” from the current object.
</li>
<li>For each subscription: If the event that occurred is in the list of subscribed
				events and the distance of the current object to the object where the event
				occurred is smaller or equal to the “depth” of the subscription or the “depth”
				is equal to “-1”, add the user of this subscription to the list of users that
				should be notified. The distance between two objects is 0 if they are the
				same object, 1 if one is the parent of the other and so on.
			
</li>
<li>Go to the parent of the current object and repeat from step 1. unless the
				current object is the root object
			
</li>
</ol><p>
		An important aspect to consider when sending notifications that include the new
		version of the object, is that every user who will be notified might be allowed to
		only see different parts of the object. Therefore, the server has to calculate the view
		of the object per user to prevent leaking of data a user might not be allowed to see.
	
</p>
<a name="pol-attachments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Attachments</h3>

<p>As explained in Section 4.3.3, each object can have a file as attachment. However,
		attachments will likely not be stored together with objects, but in a storage that is
		more suitable for files. Depending on how the server implements operations on
		attachments, it is possible that there exists an attachment for an object in the stor-
		age but the object itself is missing the “attachment” field. In any case the behavior
		of the server should be consistent. Hence, if there is no attachment field in the
		object then the attachment should be deleted and an attachment should only be
		readable if there is an attachment field in the object.
	
</p>
<a name="pol-auth-reg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Authentication and Registration</h3>

<p>When a client connects to a server, it has to provide credentials to the server, so
		that the user of the client can be authenticated. These are send in the body of the
		AUTHENTICATE request and can simply be an object containing the name and
		the password of the user. The schema of authentication is not limited thought as
		the body can contain arbitrary structured data. Server to server authentication is
		done using the DNS. When a server receives a connection from another server it
		verifies that the domain of the connecting server resolves to the same IP address
		the connection comes from.
	
</p>
<p>The REGISTER request should be supported by all servers, but can be dis-
		abled to prevent automatic creation of accounts by autonomous programs. It is
		also not required that the REGISTER command is the only way to create an ac-
		count on a server. For example, there could be sign up forms on websites or a
		server of a company could be connected to a directory service and fetch the login
		informations from there.
	
</p>
<a name="pol-msg-forw"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Message forwarding</h3>

<p>A server does not need to accept forwarded requests from other servers, if it
		shouldn’t be part of the federated network. This allows FOSP to be used in co-
		operate environments or other closed environments where federation with the
		outside world is not allowed.
	
</p>
<p>In any case, a server must never accept a forwarded request if the user of
		the request is not on the domain of the server that forwarded the request. For
		example, if server A, that is authoritative for domain “example.net”, authenticates
		to server B and then forwards a request of user “alice@wonderland.lit”, server B
		must close the connection.
	
</p>
<a name="con-init"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Connection Initiation</h3>

<p>First, the agent that wants to open a new connection has to find out which server
	to connect to and on which port. The server responsible for a certain domain is the
	server with the IP address that is assigned to the DNS A record of the do-
	main name and the port is 1337. In the future, a better approach of discovering the
	server will be necessary and probably done by using DNS SRV records.

</p>
<p>After opening a connection to a server, the initiator first sends a CONNECT
	request that has to be answered with a SUCCEEDED response if the connection
	is accepted. The body of the request contains information about the supported
	version of the protocol and could in the future be used to negotiate more pa-
	rameters of the connection. The response, if successful, contains the version the
	server supports and could also be used to advertise additional services provided
	by the server.

</p>
<p>If the connection is opened by a client to a server, a new user can then be
	registered with the REGISTER request. Finally, the initiator has to authenticate
	to the server he connects to. The specific mechanism of authentication depends
	on whether a client connects to a server or a server connects to another server.

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="refs.rfc2119">[refs.rfc2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, BCP&nbsp;14, March&nbsp;1997.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Felix K. Maurer</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:felix.maurer@student.kit.edu">felix.maurer@student.kit.edu</a></td></tr>
</table>
</body></html>
